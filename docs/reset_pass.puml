@startuml
participant Client
participant Server
database Database

Client ->> Server: Request
Server ->> Database: Request
Database ->> Server: <math>E_W_c(S_c) || U_c</math>

note over Server
  <math>"Establish " S_c = "DH"(U_c, P_s)</math>
end note

Server ->> Client: <math>E_S_c(E_W_c(S_c) || U_s) || \tau</math>


note over Client
  Decrypt private key using old password
end note

note over Client
    <math>"Establish " S_c = "DH"(U_s, P_c)</math>
end note

note over Client
  Encrypt private key using new password
end note

Client ->> Server: <math>E_S_c(E_W_c(S_c)) || \tau</math>


note over Server
    <math>"Check " \tau</math>
end note


Server ->> Database: <math>E_W_c(S_c)</math>
@enduml